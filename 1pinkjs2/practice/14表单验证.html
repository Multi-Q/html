<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>14表单验证</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        .clearfix {
            zoom: 1;
        }

        .clearfix::before,
        .clearfix::after {
            content: "";
            display: table;
        }

        .clearfix::after {
            clear: both;
        }

        :root {
            background-color: lightgray;
        }

        .register {
            width: 800px;
            height: 600px;
            margin: 50px auto;
            background-color: white;
        }

        .register h2 {
            padding-left: 35px;
            font-weight: normal;
            margin-top: 35px;
            color: #ccc;
        }

        .register form {
            margin: 35px auto;
            width: 400px;
        }

        .reg-item {
            position: relative;
            width: 100%;
            height: 30px;
            margin-top: 15px;
            box-sizing: border-box;
        }

        .reg-item i {
            position: absolute;
            left: 5px;
            top: 50%;
            transform: translateY(-50%);
            width: 15px;
            height: 15px;
            background-color: pink;
        }

        input:not([type='checkbox']) {
            float: left;
            width: 200px;
            height: 100%;
            outline: none;
            padding-left: 25px;
            font-size: 12px;
            color: #ccc;
            caret-color: black;
        }

        input[type='submit'] {
            background-color: green;
            color: white;
            cursor: pointer;
            border: 0;
            letter-spacing: 5px;
        }

        .reg-item .msg {
            display: inline-block;
            width: 180px;
            height: 30px;
            margin-left: 18px;
            font-size: 10px;
            line-height: 30px;
        }

        .send-code {
            position: absolute;
            width: 60px;
            height: 14px;
            line-height: 14px;
            top: 50%;
            transform: translateY(-50%);
            left: 135px;
            font-size: 10px !important;
            text-align: center;
            color: rgb(2, 251, 2);
            border: 0;
            background-color: transparent;
            cursor: pointer;
        }

        .reg-item>label {
            display: block;
            width: 200px;
            line-height: 30px;
            text-align: center;
            font-size: 12px;
        }

        .reg-item>label>input {
            vertical-align: middle;
            margin-right: 5px;
        }

        .reg-item>label>a {
            color: rgb(8, 204, 8);
            text-decoration: none;
        }

        .right {
            color: lightgreen;
        }

        .error {
            color: red;
        }
    </style>
</head>

<body>
    <div class="register clearfix">
        <h2>新用户注册</h2>
        <form action="#">
            <div class="reg-item ">
                <i></i>
                <input type="text" placeholder="用户名" name="username" id="username">
                <span class="msg "></span>
            </div>
            <div class="reg-item">
                <i></i>
                <input type="text" placeholder="手机号码" name="phone" id="phone">
                <span class="msg right"></span>
            </div>
            <div class="reg-item">
                <i></i>
                <input type="text" placeholder="输入短信验证码" name="phonecode" id="phonecode">
                <span class="msg"></span>
                <button class="send-code">发送验证码</button>
            </div>
            <div class="reg-item">
                <i></i>
                <input type="password" placeholder="密码" name="password" id="password">
                <span class="msg"></span>
            </div>
            <div class="reg-item">
                <i></i>
                <input type="password" placeholder="再次输入密码" name="repassword" id="repassword">
                <span class="msg"></span>
            </div>
            <div class="reg-item">
                <label>
                    <input type="checkbox" id="agree">已阅读并同意<a href="#">《用户协议》</a>
                </label>
            </div>
            <div class="reg-item">
                <input type="submit" value="下一步"></button>
            </div>
        </form>
    </div>

    <script>

        const sendCode = document.querySelector(".send-code");


        let flag = true;
        sendCode.addEventListener("click", function () {
            if (flag) {
                flag = false;
                let second = 5;
                // sendCode.innerHTML = `${second}s重试`;
                let timer = setInterval(function () {
                    sendCode.innerHTML = `${second--}s重试`;
                    if (second === 0) {
                        clearInterval(timer);
                        sendCode.innerHTML = `重新获取`;
                        flag = true;
                    }
                }, 1000);
            }
        });

        // 用户名
        const username = document.querySelector("#username");
        username.addEventListener("change", verifyName);
        function verifyName() {
            const reg = /^[a-zA-Z0-9-_]{6,10}$/;
            const span = username.nextElementSibling;
            if (!reg.test(username.value)) {
                span.classList.remove("error");
                span.classList.remove("right");
                span.innerHTML = "输入不合法，请输入6~10位";
                span.classList.add("error");
                return false;
            }
            span.classList.remove("error");
            span.classList.remove("right");
            span.innerHTML = "输入正确";
            span.classList.add("right");

            return true;
        }

        // 手机号
        const phone = document.querySelector("#phone");
        phone.addEventListener("change", verifyPhone);
        function verifyPhone() {
            const reg = /^1(3\d|4[5-9]|5[0-35-9]|6[567]|7[0-8]|8\d|9[0-35-9])\d{8}$/;
            const span = phone.nextElementSibling;
            if (!reg.test(phone.value)) {
                span.classList.remove("error");
                span.classList.remove("right");
                span.innerHTML = "输入不合法，请输入有效的手机号";
                span.classList.add("error");
                return false;
            }
            span.classList.remove("error");
            span.classList.remove("right");
            span.innerHTML = "输入正确";
            span.classList.add("right");
            return true;
        }

        // 验证码
        const phonecode = document.querySelector("#phonecode");
        phonecode.addEventListener("change", verifyPhoneCode);
        function verifyPhoneCode() {
            const reg = /^\d{6}$/;
            const span = phonecode.nextElementSibling;
            if (!reg.test(phonecode.value)) {
                span.classList.remove("error");
                span.classList.remove("right");
                span.innerHTML = "请输入6位有效的验证码";
                span.classList.add("error");
                return false;
            }
            span.classList.remove("error");
            span.classList.remove("right");
            span.innerHTML = "输入正确";
            span.classList.add("right");
            return true;
        }

        // 密码
        const password = document.querySelector("#password");
        password.addEventListener("change", verifyPassword);
        function verifyPassword() {
            const reg = /^[a-zA-Z0-9-_]{6,20}$/;
            const span = password.nextElementSibling;
            if (!reg.test(password.value)) {
                span.classList.remove("error");
                span.classList.remove("right");
                span.innerHTML = "请输入6~16位密码";
                span.classList.add("error");
                return false;
            }
            span.classList.remove("error");
            span.classList.remove("right");
            span.innerHTML = "输入正确";
            span.classList.add("right");
            return true;
        }

        // 再次输入密码
        const repassword = document.querySelector("#repassword");
        repassword.addEventListener("change", verifyRepassword)
        function verifyRepassword() {
            const span = repassword.nextElementSibling;
            if (password.value.trim() === "") {
                span.classList.remove("error");
                span.classList.remove("right");
                span.innerHTML = "两次输入密码不一致";
                span.classList.add("error");
                return false;
            }
            if (repassword.value.trim() !== password.value.trim()) {
                span.classList.remove("error");
                span.classList.remove("right");
                span.innerHTML = "两次输入密码不一致";
                span.classList.add("error");
                return false;
            }
            span.classList.remove("error");
            span.classList.remove("right");
            span.innerHTML = "验证正确";
            span.classList.add("right");
            return true;
        }

        // 同意
        const agree = document.querySelector("#agree");
        agree.addEventListener("click", verifyAgree);
        function verifyAgree() {
            if (agree.checked) {
                return true;
            }
            return false;
        }

        // 提交
        const form = document.querySelector("form");
        form.addEventListener("submit", function (e) {
            if (!verifyAgree()) {
                alert("请勾选协议");
                e.preventDefault();
                return;
            } 
            if (!verifyName()
                || !verifyPhone()
                || !verifyPhoneCode()
                || !verifyPassword()
                || !verifyRepassword()) {
                alert("请输入正确的值!!!");
                e.preventDefault();
                return;
            }

            const info = {
                username: username.value,
                password: password.value,
                repassword: repassword.value,
                phone: phone.value,
                phonecode: phonecode.value
            };
            form.reset();
            console.log(info);
        });
    </script>
</body>

</html>